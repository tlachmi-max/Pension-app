<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>סוכן פיננסי - הסוכן המשפחתי והאישי שלך</title>
    <meta name="description" content="מערכת לתכנון פיננסי אישי עם תחזיות, גרפים ומחשבון פנסיה">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#58a6ff">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="icon-512.png">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="סוכן פיננסי">
    
    <link rel="stylesheet" href="style.css">
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- Supabase Client (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="app" id="mainApp">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="app-logo">💰</div>
                <div class="app-title">
                    <h1>סוכן פיננסי</h1>
                    <div class="app-subtitle">הסוכן המשפחתי והאישי שלך</div>
                </div>
            </div>
            <div class="header-actions">
                <!-- Storage Status Indicator -->
                <div id="storageStatus" class="storage-status" title="מצב שמירה">
                    <span class="status-icon">💾</span>
                    <span class="status-text">מקומי</span>
                </div>
                
                <!-- Cloud Sync Button -->
                <button id="cloudSyncBtn" class="btn-header btn-cloud" onclick="showCloudSync()" title="סנכרון לענן">
                    <span>☁️</span>
                    <span>סנכרון</span>
                </button>
                
                <select id="planSelector" class="plan-select" onchange="switchPlan(this.value)">
                    <option value="">בחר תוכנית...</option>
                </select>
                <button class="btn-header" onclick="showPlanManager()" title="ניהול תוכניות">
                    <span>📂</span>
                    <span>תוכניות</span>
                </button>
                <button class="btn-header" onclick="exportToPDF()" title="ייצוא ל-PDF">
                    <span>📄</span>
                    <span>PDF</span>
                </button>
                <button class="btn-header" onclick="exportToExcel()" title="ייצוא ל-Excel">
                    <span>📊</span>
                    <span>Excel</span>
                </button>
                <button class="btn-header" onclick="document.getElementById('excelImport').click()" title="ייבוא Excel">
                    <span>📥</span>
                    <span>ייבוא</span>
                </button>
                <input type="file" id="excelImport" accept=".xlsx,.xls" style="display:none" onchange="importExcel(event)">
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav">
            <button class="nav-item active" data-panel="investments" onclick="switchPanel('investments')">
                <span>📊</span>
                <span>מסלולי השקעה</span>
            </button>
            <button class="nav-item" data-panel="dreams" onclick="switchPanel('dreams')">
                <span>🎯</span>
                <span>חלומות</span>
            </button>
            <button class="nav-item" data-panel="projections" onclick="switchPanel('projections')">
                <span>📈</span>
                <span>תחזיות</span>
            </button>
            <button class="nav-item" data-panel="summary" onclick="switchPanel('summary')">
                <span>📋</span>
                <span>סיכום</span>
            </button>
            <button class="nav-item" data-panel="charts" onclick="switchPanel('charts')">
                <span>📊</span>
                <span>גרפים</span>
            </button>
            <button class="nav-item" data-panel="tasks" onclick="switchPanel('tasks')">
                <span>✓</span>
                <span>משימות</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="content">
            <!-- Panel 1: Investments -->
            <div id="investments" class="panel active">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>➕</span>
                            <span id="investmentFormTitle">הוסף מסלול השקעה</span>
                        </div>
                    </div>
                    
                    <form id="investmentForm" onsubmit="saveInvestment(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">
                                    <span class="required">*</span>
                                    שם המסלול
                                </label>
                                <input type="text" class="form-input" id="invName" placeholder="קרן פנסיה מיטב דש" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">בית השקעות / תיק</label>
                                <input type="text" class="form-input" id="invHouse" placeholder="מיטב / תיק אישי">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span class="required">*</span>
                                    סוג המסלול
                                </label>
                                <select class="form-select" id="invType" onchange="updateTaxRate()" required>
                                    <option value="פנסיה">פנסיה (פטור ממס)</option>
                                    <option value="קרן השתלמות">קרן השתלמות (פטור ממס)</option>
                                    <option value="גמל להשקעה">גמל להשקעה (מס 25%)</option>
                                    <option value="תיק עצמאי">תיק עצמאי (מס 25%)</option>
                                    <option value="פוליסת חסכון">פוליסת חסכון (מס 25%)</option>
                                    <option value="פקדון">פקדון (מס 15%)</option>
                                    <option value="אחר">אחר</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">שיעור מס על רווחים (%)</label>
                                <input type="number" class="form-input" id="invTax" value="0" min="0" max="100" step="0.1">
                            </div>
                        </div>
                        
                        <!-- Gender Selection for Pension -->
                        <div id="genderSection" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">מגדר (לצורך חישוב פנסיה)</label>
                                <select class="form-select" id="invGender">
                                    <option value="male">זכר (מקדם 0.005)</option>
                                    <option value="female">נקבה (מקדם 0.006)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">סכום נוכחי (₪)</label>
                                <input type="text" inputmode="numeric" pattern="[0-9,\.]*" class="form-input" id="invAmount" value="0" placeholder="0">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">הפקדה חודשית (₪)</label>
                                <input type="text" inputmode="numeric" pattern="[0-9,\.]*" class="form-input" id="invMonthly" value="0" placeholder="0">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">תשואה צפויה (% שנתי)</label>
                                <input type="number" class="form-input" id="invReturn" value="6" min="0" max="30" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">דמי ניהול מהפקדה (%)</label>
                                <input type="number" class="form-input" id="invFeeDeposit" value="0" min="0" max="10" step="0.1">
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">דמי ניהול מצבירה (% שנתי)</label>
                                <input type="number" class="form-input" id="invFeeAnnual" value="0" min="0" max="5" step="0.01">
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-group">
                                    <input type="checkbox" class="checkbox" id="invForDream">
                                    <span>מיועד למימוש חלומות</span>
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-group">
                                    <input type="checkbox" class="checkbox" id="invInclude" checked>
                                    <span>כלול בחישוב הון עצמי</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Sub-Tracks Section -->
                        <div id="subTracksSection" style="display: none;">
                            <div class="sub-tracks-header">
                                <h3>תתי-מסלולים (פיצול השקעות)</h3>
                                <p class="sub-tracks-note">חובה: סך כל האחוזים חייב להיות 100%</p>
                            </div>
                            
                            <div id="subTracksList" class="sub-tracks-list"></div>
                            
                            <div class="sub-track-add">
                                <!-- Row 1: Type Selection -->
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label class="form-label">סוג תת-מסלול</label>
                                    <select class="form-select" id="subTrackType" style="width: 100%;">
                                        <option value="מדדי מניות חו״ל">מדדי מניות חו״ל (7%)</option>
                                        <option value="מדדי מניות בארץ">מדדי מניות בארץ (7%)</option>
                                        <option value="מניות סחיר חו״ל">מניות סחיר חו״ל (7%)</option>
                                        <option value="מניות סחיר בארץ">מניות סחיר בארץ (7%)</option>
                                        <option value="אג״ח">אג״ח (4%)</option>
                                        <option value="S&P 500">S&P 500 (7%)</option>
                                        <option value="נדל״ן">נדל״ן (6%)</option>
                                        <option value="עו״ש">עו״ש (0%)</option>
                                        <option value="קרן כספית">קרן כספית/פקדון (3%)</option>
                                        <option value="כללי">כללי (5%)</option>
                                        <option value="אחר">אחר - הזן שם מותאם</option>
                                    </select>
                                </div>
                                
                                <!-- Custom Name Field (shown only when "אחר" is selected) -->
                                <div class="form-group" id="customNameField" style="margin-bottom: 16px; display: none;">
                                    <label class="form-label">שם תת-מסלול מותאם</label>
                                    <input type="text" class="form-input" id="subTrackCustomName" placeholder="לדוגמה: קרן נאמנות טכנולוגיה" style="width: 100%;">
                                </div>
                                
                                <!-- Manual Risk Level (shown for נדל"ן and אחר) -->
                                <div class="form-group" id="manualRiskField" style="margin-bottom: 16px; display: none;">
                                    <label class="form-label">רמת סיכון (בחירה ידנית)</label>
                                    <select class="form-select" id="subTrackRiskLevel" style="width: 100%;">
                                        <option value="">בחר רמת סיכון...</option>
                                        <option value="low">נמוך 🟢</option>
                                        <option value="medium">בינוני 🟡</option>
                                        <option value="high">גבוה 🔴</option>
                                    </select>
                                </div>
                                
                                <!-- Row 2: Numbers -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                    <div class="form-group">
                                        <label class="form-label">אחוז %</label>
                                        <input type="text" inputmode="decimal" pattern="[0-9,\.]*" class="form-input" id="subTrackPercent" placeholder="60" style="width: 100%;">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">תשואה %</label>
                                        <input type="number" class="form-input" id="subTrackReturn" placeholder="7" step="0.1" style="width: 100%;">
                                    </div>
                                </div>
                                
                                <!-- Row 3: Big Add Button -->
                                <button type="button" class="btn btn-success" onclick="addSubTrack()" style="width: 100%; min-height: 60px; font-size: 1.5em; margin-bottom: 12px;">
                                    ➕ הוסף תת-מסלול
                                </button>
                                
                                <div id="subTrackError" class="error-message"></div>
                                <div id="subTrackTotal" class="sub-track-total"></div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-success btn-full">
                                <span>💾</span>
                                <span id="btnSaveText">שמור מסלול</span>
                            </button>
                            <button type="button" class="btn btn-secondary btn-full" id="btnCancelEdit" onclick="cancelEditInvestment()" style="display:none;">
                                <span>❌</span>
                                <span>בטל עריכה</span>
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>📋</span>
                            <span>מסלולים קיימים (<span id="invCount">0</span>)</span>
                        </div>
                    </div>
                    <div id="investmentsList" class="items-list"></div>
                </div>
            </div>

            <!-- Panel 2: Dreams -->
            <div id="dreams" class="panel">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>🎯</span>
                            <span>הגדר חלום פיננסי</span>
                        </div>
                    </div>
                    
                    <form id="dreamForm" onsubmit="saveDream(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">
                                    <span class="required">*</span>
                                    שם החלום
                                </label>
                                <input type="text" class="form-input" id="dreamName" placeholder="קניית דירה" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span class="required">*</span>
                                    עלות (₪)
                                </label>
                                <input type="text" inputmode="numeric" pattern="[0-9,\.]*" class="form-input" id="dreamCost" value="0" placeholder="0" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span class="required">*</span>
                                    שנת יעד
                                </label>
                                <input type="number" class="form-input" id="dreamYear" value="2030" min="2025" max="2060" required>
                            </div>
                            
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label class="form-label">מקורות מימון (אפשר לבחור מספר)</label>
                                <select class="form-select" id="dreamSources" multiple style="min-height: 120px;">
                                    <option value="">לא מוגדר</option>
                                </select>
                                <p class="sub-tracks-note" style="margin-top: 8px;">
                                    החלום יתחלק באופן שווה בין המקורות הנבחרים.
                                    <br>
                                    <small>💡 טיפ: החזק Ctrl/Cmd ולחץ לבחירת מספר מסלולים</small>
                                </p>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-success btn-full">
                            <span>💾</span>
                            <span>שמור חלום</span>
                        </button>
                    </form>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>📋</span>
                            <span>חלומות קיימים (<span id="dreamCount">0</span>)</span>
                        </div>
                    </div>
                    <div id="dreamsList" class="items-list"></div>
                </div>
            </div>

            <!-- Panel 3: Projections -->
            <div id="projections" class="panel">
                <div class="alert alert-info">
                    <span class="alert-icon">💡</span>
                    <div>
                        <strong>הסבר:</strong> התחזיות מחושבות עם ריבית דריבית מלאה, 
                        התחשבות בדמי ניהול ואינפלציה של 2% בשנה.
                        <strong>המס מחושב רק על הרווחים</strong> - לא על כל הסכום.
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>📈</span>
                            <span>תחזית פיננסית</span>
                        </div>
                        <div class="flex gap-2 items-center">
                            <label>שנים:</label>
                            <input type="number" class="form-input" id="projYears" value="30" min="5" max="50" style="width: 100px;">
                            <button class="btn btn-primary btn-sm" onclick="renderProjections()">עדכן</button>
                        </div>
                    </div>
                    
                    <div class="form-group mb-2">
                        <label class="form-label">הצג פירוט לשנה ספציפית:</label>
                        <div class="flex gap-2">
                            <input type="number" class="form-input" id="specificYear" placeholder="לדוגמה: 2035" min="2025" max="2075" style="flex: 1;">
                            <button class="btn btn-primary" onclick="showYearDetails()">
                                <span>🔍</span>
                                <span>הצג פירוט</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="yearDetailsContainer" style="display: none;"></div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>שנה</th>
                                    <th>ערך נומינלי</th>
                                    <th>ערך ריאלי</th>
                                    <th>מס במשיכה</th>
                                    <th>נטו לאחר מס</th>
                                </tr>
                            </thead>
                            <tbody id="projectionsBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Panel 4: Summary -->
            <div id="summary" class="panel">
                <div class="alert alert-info">
                    <span class="alert-icon">💡</span>
                    <div>
                        <strong>מה ההבדל?</strong><br>
                        • <strong>נומינלי</strong> - הסכום בפועל בחשבון<br>
                        • <strong>ריאלי</strong> - כוח קנייה לאחר התאמה לאינפלציה<br>
                        • <strong>מס</strong> - המס שתשלם רק על הרווחים (לא על כל הסכום!)
                    </div>
                </div>
                
                <!-- Total Today Card -->
                <div class="stat-card blue" style="margin-bottom: 24px; border: 3px solid #3b82f6;">
                    <div class="stat-label" style="font-size: 1.2em; font-weight: bold;">💰 סך הכל היום</div>
                    <div class="stat-value" id="sumToday" style="font-size: 2.5em; color: #3b82f6;">₪0</div>
                    <div class="stat-detail">הסכום הנוכחי בכל המסלולים</div>
                </div>
                
                <div class="flex justify-between items-center mb-3">
                    <h2>תחזית עתידית</h2>
                    <div class="flex gap-2 items-center">
                        <label>בעוד:</label>
                        <input type="number" class="form-input" id="sumYears" value="30" min="1" max="50" style="width: 100px;">
                        <label>שנים</label>
                        <button class="btn btn-primary btn-sm" onclick="renderSummary()">עדכן</button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card green">
                        <div class="stat-label">ערך נומינלי כולל</div>
                        <div class="stat-value" id="sumNominal">₪0</div>
                        <div class="stat-detail" id="sumYearsLabel">בעוד 30 שנה</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">ערך ריאלי (כוח קנייה)</div>
                        <div class="stat-value" id="sumReal">₪0</div>
                        <div class="stat-detail">שווה ערך לכסף של היום</div>
                    </div>
                    
                    <div class="stat-card red">
                        <div class="stat-label">סה"כ דמי ניהול</div>
                        <div class="stat-value" id="sumFees">₪0</div>
                        <div class="stat-detail">עלות דמי הניהול על התקופה</div>
                    </div>
                    
                    <div class="stat-card orange">
                        <div class="stat-label">מס על רווחים</div>
                        <div class="stat-value" id="sumTax">₪0</div>
                        <div class="stat-detail">המס שתשלם במשיכה מלאה</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title mb-3">פירוט מסלולי השקעה</div>
                    <div id="summaryBreakdown" class="items-list"></div>
                </div>
            </div>

            <!-- Panel 5: Charts -->
            <div id="charts" class="panel">
                <div class="card">
                    <div class="card-title mb-3">📊 חלוקה לפי תתי-מסלולים</div>
                    <canvas id="chartBySubTracks"></canvas>
                    <button class="btn btn-sm btn-secondary" onclick="downloadChart('chartBySubTracks', 'תתי-מסלולים')" style="margin-top: 12px; width: 100%;">
                        💾 שמור כתמונה
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-title mb-3">📈 חלוקה לפי סוג מסלול</div>
                    <canvas id="chartByType"></canvas>
                    <button class="btn btn-sm btn-secondary" onclick="downloadChart('chartByType', 'סוג-מסלול')" style="margin-top: 12px; width: 100%;">
                        💾 שמור כתמונה
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-title mb-3">🏢 חלוקה לפי בית השקעות</div>
                    <canvas id="chartByHouse"></canvas>
                    <button class="btn btn-sm btn-secondary" onclick="downloadChart('chartByHouse', 'בית-השקעות')" style="margin-top: 12px; width: 100%;">
                        💾 שמור כתמונה
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-title mb-3">💸 חלוקה לפי מיסוי</div>
                    <canvas id="chartByTax"></canvas>
                    <button class="btn btn-sm btn-secondary" onclick="downloadChart('chartByTax', 'מיסוי')" style="margin-top: 12px; width: 100%;">
                        💾 שמור כתמונה
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-title mb-3">⚠️ חלוקה לפי רמת סיכון</div>
                    <canvas id="chartByRisk"></canvas>
                    <button class="btn btn-sm btn-secondary" onclick="downloadChart('chartByRisk', 'סיכון')" style="margin-top: 12px; width: 100%;">
                        💾 שמור כתמונה
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-title mb-3">📸 נקודת ייחוס</div>
                    <p style="margin-bottom: 16px;">שמור את מצב התיק הנוכחי כנקודת התחלה להשוואה עתידית</p>
                    <button class="btn btn-primary" onclick="saveSnapshot()">📸 שמור נקודת ייחוס</button>
                </div>
            </div>

            <!-- Panel 6: Tasks -->
            <div id="tasks" class="panel">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>✓</span>
                            <span>משימות לביצוע ומעקב</span>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-3">
                        <input type="text" 
                               class="form-input" 
                               id="newTask" 
                               placeholder="הוסף משימה חדשה..." 
                               style="flex: 1;"
                               onkeypress="if(event.key==='Enter') addTask()">
                        <button class="btn btn-success" onclick="addTask()">
                            <span>➕</span>
                            <span>הוסף</span>
                        </button>
                    </div>
                    
                    <div id="tasksList"></div>
                    
                    <div class="alert alert-info mt-3">
                        <span class="alert-icon">📊</span>
                        <div>
                            <strong>התקדמות:</strong>
                            <span id="taskProgress">0% הושלמו</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Plan Manager Modal -->
    <div id="planModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ניהול תוכניות</h2>
                <button class="btn-close" onclick="closePlanManager()">✕</button>
            </div>
            <div class="modal-body">
                <button class="btn btn-success btn-full mb-2" onclick="createNewPlan()">
                    <span>➕</span>
                    <span>צור תוכנית חדשה</span>
                </button>
                <div id="plansList"></div>
            </div>
        </div>
    </div>

    <!-- Cloud Sync Modal -->
    <div id="cloudSyncModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 id="cloudSyncTitle">☁️ סנכרון לענן</h2>
                <button class="btn-close" onclick="closeCloudSync()">✕</button>
            </div>
            <div class="modal-body">
                <!-- Guest Mode Info -->
                <div id="guestModeInfo" class="alert alert-info">
                    <span class="alert-icon">💾</span>
                    <div>
                        <strong>מצב אורח</strong><br>
                        הנתונים שלך נשמרים מקומית במכשיר זה בלבד.<br>
                        התחבר כדי לסנכרן בין מכשירים ולגבות בענן.
                    </div>
                </div>

                <!-- Login Form -->
                <div id="loginForm">
                    <div class="form-group">
                        <label class="form-label">אימייל</label>
                        <input type="email" class="form-input" id="cloudEmail" placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">סיסמה</label>
                        <input type="password" class="form-input" id="cloudPassword" placeholder="••••••">
                    </div>
                    <button class="btn btn-primary btn-full" onclick="cloudLogin()">
                        <span>🔐</span>
                        <span>התחבר וסנכרן</span>
                    </button>
                    <button class="btn btn-secondary btn-full" onclick="showCloudRegister()">
                        <span>✅</span>
                        <span>הרשמה</span>
                    </button>
                </div>

                <!-- Register Form -->
                <div id="registerForm" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">אימייל</label>
                        <input type="email" class="form-input" id="registerEmail" placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">סיסמה</label>
                        <input type="password" class="form-input" id="registerPassword" placeholder="לפחות 6 תווים">
                    </div>
                    <div class="form-group">
                        <label class="form-label">אימות סיסמה</label>
                        <input type="password" class="form-input" id="registerConfirm" placeholder="הזן סיסמה שוב">
                    </div>
                    <button class="btn btn-success btn-full" onclick="cloudRegister()">
                        <span>✅</span>
                        <span>הרשם וסנכרן</span>
                    </button>
                    <button class="btn btn-secondary btn-full" onclick="showCloudLogin()">
                        <span>◀</span>
                        <span>חזרה להתחברות</span>
                    </button>
                </div>

                <!-- Logged In View -->
                <div id="loggedInView" style="display: none;">
                    <div class="alert alert-success">
                        <span class="alert-icon">✅</span>
                        <div>
                            <strong>מחובר לענן</strong><br>
                            <span id="cloudUserEmail"></span><br>
                            הנתונים שלך מסונכרנים בזמן אמת
                        </div>
                    </div>
                    <button class="btn btn-danger btn-full" onclick="cloudLogout()">
                        <span>🚪</span>
                        <span>התנתק (המשך מקומי)</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Check Supabase loaded -->
    <script>
        console.log('🔍 Checking Supabase library...');
        console.log('window.supabase:', typeof window.supabase);
        if (typeof window.supabase !== 'undefined') {
            console.log('✅ Supabase library loaded from CDN');
            console.log('createClient available:', typeof window.supabase.createClient);
        } else {
            console.error('❌ Supabase library NOT loaded!');
        }
    </script>

    <!-- Load JavaScript -->
    <script src="script.js"></script>
    <script src="cloud-sync.js"></script>
    
    <!-- PWA Registration -->
    <script src="pwa-register.js"></script>
</body>
</html>
